---
install_packages:
  - 'dnsmasq'
  - 'stubby'
user_groups:
  - 'stubby'
users:
  - 'stubby'
create_files:
  - owner:              'pi'
    group:              'pi'
    mode:               '0700'
    path:               '~pi/.ssh'
    state:              'directory'
  - owner:              'pi'
    group:              'pi'
    mode:               '0644'
    state:              'touch'
    path:               '/var/log/update_dns.log'
  - owner:              'pi'
    group:              'pi'
    mode:               '0644'
    state:              'touch'
    path:               '/var/log/update_dns.ret'
  - owner:              'stubby'
    group:              'stubby'
    mode:               '0644'
    state:              'touch'
    path:               '/var/log/stubby.log'
install_files:
  - owner:              'root'
    group:              'root'
    mode:               '0755'
    src:                "{{ role_path }}/files/bin/update_dns"
    dest:               '/usr/local/bin/update_dns'
  - owner:              'root'
    group:              'root'
    mode:               '0755'
    src:                "{{ role_path }}/files/bin/update_dns_cronjob"
    dest:               '/usr/local/bin/update_dns_cronjob'
  - owner:              'root'
    group:              'root'
    mode:               '0644'
    src:                "{{ role_path }}/files/cron.d/update_dns"
    dest:               '/etc/cron.d/update_dns'
  - owner:              'root'
    group:              'root'
    mode:               '0644'
    src:                "{{ role_path }}/files/conf/default.dnsmasq"
    dest:               '/etc/default/dnsmasq'
  - owner:              'root'
    group:              'root'
    mode:               '0644'
    src:                "{{ role_path }}/files/conf/stubby.yml"
    dest:               '/etc/stubby/stubby.yml'
  - owner:              'root'
    group:              'root'
    mode:               '0755'
    src:                "{{ role_path }}/files/init.d/stubby"
    dest:               '/etc/init.d/stubby'
template_files:
  - owner:              'root'
    group:              'root'
    mode:               '0644'
    src:                "{{ role_path }}/templates/hosts.j2"
    dest:               '/etc/hosts'
  - owner:              'root'
    group:              'root'
    mode:               '0644'
    src:                "{{ role_path }}/templates/conf/dnsmasq.conf.j2"
    dest:               '/etc/dnsmasq.conf'
adjust_files:
  - owner:              'root'
    group:              'stubby'
    mode:               '0754'
    path:               '/usr/bin/stubby'
enable_services:
  - 'dnsmasq'
  - 'stubby'
capabilities:
  - capability:                 'cap_net_bind_service+ep'
    path:                       '/usr/bin/stubby'
start_services:
  - 'dnsmasq'
  - 'stubby'
restart_services:
  - 'dnsmasq'
  - 'stubby'
